<!-- 字体引入 -->
{{ $fontName := "JianShouMengWaChaoCuYuanTi-2.ttf" }}
{{ $fontPath := printf "assets/font/%s" $fontName }}

{{ if fileExists $fontPath }}
<style>
  @font-face {
    font-family: 'MengWaXiYuan';
    src: url('{{ (resources.Get "font/JianShouMengWaChaoCuYuanTi-2.ttf").Permalink }}') format('truetype');
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }

  /* 应用字体 */
  :root {
    --font-primary: 'MengWaXiYuan', sans-serif;
  }
  
  /* 应用字体到所有元素 */
  body,
  html {
    font-family: var(--font-primary) !important;
  }
  
  /* Hugo Stack 主题特定的文章内容区域 */
  .article-content,
  .single__contents,
  .widget--toc {
    font-family: var(--font-primary) !important;
  }
  
  /* 确保文章内容内的所有文本都继承字体 */
  .article-content *:not(code):not(pre):not(.chroma):not(.highlight) {
    font-family: inherit !important;
  }
  
  /* 标题字体 */
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-primary) !important;
  }
</style>
{{ end }}

<!-- TOC 折叠样式 -->
<style>
  #TableOfContents > ul ul,
  #TableOfContents > ul ol,
  #TableOfContents > ol ul,
  #TableOfContents > ol ol {
    display: none;
  }
  
  #TableOfContents .open {
    display: block !important;
  }
</style>

<!-- TOC 折叠脚本 -->
<script>
  function initTocHide() {
    let toc = document.querySelector(".widget--toc");
    if (!toc) return;
    
    let timer = null;
    window.addEventListener('scroll', function() {
      clearTimeout(timer);
      timer = setTimeout(() => {
        document.querySelectorAll(".open").forEach(el => el.classList.remove("open"));
        
        const currentLi = document.querySelector(".active-class");
        if (!currentLi) return;

        if (currentLi.children.length > 1) {
          currentLi.children[1].classList.add("open");
        }

        let parentUl = currentLi.parentElement;
        while (parentUl && (parentUl.tagName === 'UL' || parentUl.tagName === 'OL')) {
          parentUl.classList.add("open");
          const grandParent = parentUl.parentElement;
          parentUl = grandParent ? grandParent.parentElement : null;
        }
      }, 80);
    });
  }
  
  document.addEventListener('DOMContentLoaded', initTocHide);
</script>

<!-- 其他自定义 partial -->
{{ partial "footer/code-block.html" . }}
{{ partial "footer/fish.html" . }}
{{/* {{ partial "footer/return.html" . }} */}}
{{ partial "footer/copy.html" . }}
{{ partial "footer/font.html" . }}